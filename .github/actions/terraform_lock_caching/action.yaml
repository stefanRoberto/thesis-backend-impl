name: 'Create and use Terraform cache'
description: 'This is a composite action that makes the creation and use of Terraform caches easier.'

inputs:
  tf-directory:
    description: 'The directory where Terraform commands are run'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Configure Terraform plugin cache
      shell: bash
      run: |
        echo 'plugin_cache_dir = "$HOME/.terraform.d/plugin-cache"' > ~/.terraformrc
        mkdir -p ~/.terraform.d/plugin-cache

    - name: Cache Terraform
      uses: actions/cache@v3
      with:
        path: ~/.terraform.d/plugin-cache
        key: ${{ runner.os }}-terraform-${{ hashFiles(format('{0}/.terraform.lock.hcl', inputs.tf-directory)) }}
        restore-keys: ${{ runner.os }}-terraform-